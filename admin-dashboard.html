<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Amazon Africa - Admin Dashboard</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f8fafc;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #111827;
    }
    .form-section, .table-section {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    input, select {
      padding: 8px;
      margin: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 14px;
      cursor: pointer;
    }
    button:hover { background: #1e40af; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th { background: #e5e7eb; }
    .action-btn {
      margin: 0 3px;
      padding: 5px 8px;
      font-size: 0.9em;
    }
    .delete { background: #dc2626; }
    .delete:hover { background: #991b1b; }
  </style>
</head>
<body>
  <h1>Admin Dashboard</h1>
  <div class="form-section">
    <h2>Add / Update Order</h2>
    <form id="orderForm">
      <input type="hidden" id="orderId">
      <input type="text" id="sender_name" placeholder="Sender Name" required>
      <input type="text" id="sender_country" placeholder="Sender Country" required>
      <input type="text" id="name" placeholder="Receiver Name" required>
      <input type="text" id="country" placeholder="Receiver Country" required>
      <input type="text" id="track_id" placeholder="Track ID" required>
      <input type="text" id="goods" placeholder="Goods" required>
      <input type="number" id="amount" placeholder="Amount" required>
      <select id="paid">
        <option value="true">Paid</option>
        <option value="false">Not Paid</option>
      </select>
      <select id="status">
        <option value="Pending">Pending</option>
        <option value="Delivered">Delivered</option>
        <option value="In Transit">In Transit</option>
      </select>
      <button type="submit">Save</button>
    </form>
  </div>

  <div class="table-section">
    <h2>All Orders</h2>
    <table id="ordersTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Sender</th>
          <th>Receiver</th>
          <th>Track ID</th>
          <th>Goods</th>
          <th>Amount</th>
          <th>Paid</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script type="module">

      import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const SUPABASE_URL = "https://uareyvicfwneodbzjgwo.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVhcmV5dmljZnduZW9kYnpqZ3dvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1MTEzODksImV4cCI6MjA3NzA4NzM4OX0.L_o53GwxnN3q3XMhq1X9VtFNRbydWmU_qz01eTuyO8I"; // replace with real anon key
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // Ensure only admin can access
    if (localStorage.getItem("isAdmin") !== "true") {
      alert("Access denied!");
      window.location.href = "admin-login.html";
    }

    const form = document.getElementById("orderForm");
    const tableBody = document.querySelector("#ordersTable tbody");
    const orderIdInput = document.getElementById("orderId");

    // CREATE / UPDATE
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const orderData = {
        sender_name: sender_name.value,
        sender_country: sender_country.value,
        name: name.value,
        country: country.value,
        track_id: track_id.value,
        goods: goods.value,
        amount: parseFloat(amount.value),
        paid: paid.value === "true",
        status: status.value,
      };

      if (orderIdInput.value) {
        await supabase.from("orders").update(orderData).eq("id", orderIdInput.value);
        orderIdInput.value = "";
      } else {
        await supabase.from("Order").insert([orderData]);
      }

      form.reset();
      loadOrders();
    });

    // READ
    async function loadOrders() {
      const { data, error } = await supabase.from("Order").select("*").order("id", { ascending: false });
      if (error) return console.error(error);

      tableBody.innerHTML = data.map(order => `
        <tr>
          <td>${order.id}</td>
          <td>${order.sender_name}</td>
          <td>${order.name}</td>
          <td>${order.track_id}</td>
          <td>${order.goods}</td>
          <td>‚Ç¶${order.amount}</td>
          <td>${order.paid ? "‚úÖ" : "‚ùå"}</td>
          <td>${order.status}</td>
          <td>
            <button class="action-btn" onclick='editOrder(${JSON.stringify(order)})'>‚úèÔ∏è</button>
            <button class="action-btn delete" onclick="deleteOrder(${order.id})">üóëÔ∏è</button>
          </td>
        </tr>
      `).join("");
    }

    // UPDATE
    window.editOrder = (order) => {
      orderId.value = order.id;
      sender_name.value = order.sender_name;
      sender_country.value = order.sender_country;
      name.value = order.name;
      country.value = order.country;
      track_id.value = order.track_id;
      goods.value = order.goods;
      amount.value = order.amount;
      paid.value = order.paid ? "true" : "false";
      status.value = order.status;
    };

    // DELETE
    window.deleteOrder = async (id) => {
      if (confirm("Are you sure you want to delete this order?")) {
        await supabase.from("Order").delete().eq("id", id);
        loadOrders();
      }
    };

    loadOrders();
  </script>
</body>
  </html>
  
